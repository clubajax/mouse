<!DOCTYPE HTML>
<html lang="en">
<head>
	<title>Test Mouse</title>
	<link rel="stylesheet" href="../bower_components/mocha/mocha.css">
	<script src="../bower_components/mocha/mocha.js"></script>
	<script src="../bower_components/chai/chai.js"></script>
	<script src="../bower_components/on/dist/on.js"></script>
	<script src="../bower_components/dom/src/dom.js"></script>
	<script src="../src/mouse.js"></script>

	<style>
		body {
			padding: 20px;
			font-family: sans-serif;
		}

		.wrap{
			position: relative;
		}
		#container {
			border: 1px solid #ccc;
			background-color: #eee;
			width: 200px;
			height: 200px;
			cursor: move;
			position: relative;
		}
		#ta{
			position: absolute;
			top: 0;
			left: 220px;
			width: 200px;
			height: 200px;
		}
		#container span{
			width: 30px;
			height: 30px;
			background-color: #ddd;
			position: absolute;
		}
		#container span:first-child{
			top: 20px;
			left: 20px;
		}
		#container span:last-of-type{
			right: 20px;
			bottom: 20px;
		}
		#dragger{
			position: absolute;
			border: 1px solid #666;
			background-color: white;
			width: 20px;
			height: 20px;
			top: 90px;
			left: 90px;
		}
	</style>

</head>
<body>
<h1>Test Mouse</h1>
<div id="mocha"></div>
<div class="wrap">
	<div id="container">
		<span></span>
		<span></span>
		<div id="dragger"></div>
	</div>
	<textarea id="ta"></textarea>
</div>
<script>
	mocha.setup('tdd');

	suite('Mouse', function () {
		this.timeout(3000);
		var suite = window.suite,
			test = window.test,
			dom = window.dom,
			on = window.on,
			expect = chai.expect,
			body = document.body;

		suite('mouse', function () {

			test('it should ', function () {
				var
					node = dom.byId('container'),
					downNode = dom.byId('dragger'),
					pBox = dom.box(node),
					dBox = dom.box(downNode),
					dx = dBox.x - pBox.x,
					dy = dBox.y - pBox.y,
					dw = pBox.w - dBox.w,
					dh = pBox.h - dBox.h,
					ta = dom.byId('ta');

				mouse(node, {
					downNode: downNode
				});

				on(node, 'mouse', function (e) {
					//console.log('mouse', e);
					var logs = [
						'x: ' + e.x,
						'y: ' + e.y,
						'lx: ' + e.last.x,
						'ly: ' + e.last.y,
						'px: ' + e.px,
						'py: ' + e.py,
						'dx: ' + e.dist.x,
						'dy: ' + e.dist.y,
						'ox: ' + e.org.x,
						'oy: ' + e.org.y
					];

					ta.value = logs.join('\n');

					dx += e.last.x;
					dy += e.last.y;
					dx = Math.max(0, Math.min(dx, dw));
					dy = Math.max(0, Math.min(dy, dh));
					dom.style(downNode, {
						left: dx,
						top: dy
					});
				});
			});


		});

	});

	mocha.run();

</script>
</body>
</html>