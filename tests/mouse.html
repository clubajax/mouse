<!DOCTYPE HTML>
<html lang="en">
<head>
	<title>Test Mouse</title>
	<link rel="stylesheet" href="../bower_components/mocha/mocha.css">
	<script src="../bower_components/mocha/mocha.js"></script>
	<script src="../bower_components/chai/chai.js"></script>
	<script src="../bower_components/on/dist/on.js"></script>
	<script src="../bower_components/dom/src/dom.js"></script>
	<script src="../src/mouse.js"></script>

	<style>
		body {
			padding: 20px;
			font-family: sans-serif;
		}

		.wrap{
			position: relative;
			position: absolute;
			top: 50px;
			left: 50px;
		}
		#container {

			border: 1px solid #ccc;
			background-color: #eee;
			width: 200px;
			height: 200px;
			cursor: move;
			position: relative;
		}
		#ta{
			position: absolute;
			top: 0;
			left: 220px;
			width: 200px;
			height: 200px;
		}

		.dragger{
			position: absolute;
			border: 1px solid #666;
			background-color: white;
			width: 20px;
			height: 20px;
		}
		#d1{
			top: 90px;
			left: 90px;
		}
		#d2{
			top: 20px;
			left: 20px;
			background-color: #ffffdc;
		}
		#d3{
			bottom: 20px;
			right: 20px;
			background-color: #ffe3e6;
		}
	</style>

</head>
<body>
<h1>Test Mouse</h1>
<div id="mocha"></div>
<div class="wrap">
	<div id="container">
		<div class="dragger" id="d1"></div>
		<div class="dragger" id="d2"></div>
		<div class="dragger" id="d3"></div>
	</div>
	<textarea id="ta"></textarea>
</div>
<script>
	mocha.setup('tdd');

	suite('Mouse', function () {
		this.timeout(3000);
		var suite = window.suite,
			test = window.test,
			dom = window.dom,
			on = window.on,
			expect = chai.expect,
			body = document.body;

		suite('mouse', function () {

			test('it should ', function () {
				var
					node = dom.byId('container'),
					downNodes = [
						dom.byId('d1'),
						dom.byId('d2'),
						dom.byId('d3')
					],
					pBox = dom.box(node)
					ta = dom.byId('ta');

				mouse(node, {
					downNodes: downNodes
				});

				on(node, 'mouse', function (e) {
					var logs = [
						'x: ' + e.x,
						'y: ' + e.y,
						'lx: ' + e.last.x,
						'ly: ' + e.last.y,
						'px: ' + e.px,
						'py: ' + e.py,
						'dx: ' + e.dist.x,
						'dy: ' + e.dist.y,
						'ox: ' + e.org.x,
						'oy: ' + e.org.y,
						'ow: ' + e.org.w,
						'oh: ' + e.org.h
					];

					ta.value = logs.join('\n');
				});
			});

			test.only('it should ', function () {
				var
					node = dom.byId('container'),
					downNodes = [
						dom.byId('d1'),
						dom.byId('d2'),
						dom.byId('d3')
					],
					pBox = dom.box(node),
					dBox = null,
					ta = dom.byId('ta');

				mouse(node, {
					downNodes: downNodes
				});

				on(node, 'mouse', function (e) {
					var logs = [
						'x: ' + e.x,
						'y: ' + e.y,
						'lx: ' + e.last.x,
						'ly: ' + e.last.y,
						'px: ' + e.px,
						'py: ' + e.py,
						'dx: ' + e.dist.x,
						'dy: ' + e.dist.y,
						'ox: ' + e.org.x,
						'oy: ' + e.org.y,
						'ow: ' + e.org.w,
						'oh: ' + e.org.h
					];

					if(e.down){
						dx = e.org.x;
						dy = e.org.y;
						dw = pBox.w - e.org.w;
						dh = pBox.h - e.org.h;
					}

					ta.value = logs.join('\n');

					dx += e.last.x;
					dy += e.last.y;

					dx = Math.max(0, Math.min(dx, dw));
					dy = Math.max(0, Math.min(dy, dh));

					dom.style(e.mouseTarget, {
						left: dx,
						top: dy
					});
				});
			});
		});

	});

	mocha.run();

</script>
</body>
</html>